# 优化计划 - Proxy Subscription Manager
**执行时间**: 今晚
**预计总时间**: 3-4 小时

---

## ✅ 已完成的紧急修复

### 1. 服务器崩溃问题 (CRITICAL)
- **问题**: 启动服务器后应用直接退出
- **修复**: 
  - 移除了 `tokio::signal::ctrl_c()` (不适用于 GUI 应用)
  - 统一使用 `get_config_path()` 获取配置文件路径
  - 支持开发模式和生产模式的不同路径
  - 自动创建应用数据目录和默认配置

### 2. 删除按钮无响应 (HIGH)
- **问题**: 点击删除按钮没有任何反应
- **根本原因**: Tauri command 签名不匹配 - 缺少 `app_handle` 参数
- **修复**: 所有 CRUD 命令都添加了 `app_handle` 参数

### 3. UI 消息提示优化 (MEDIUM)
- 成功消息文字颜色改为深绿色（可见）
- 错误消息文字颜色改为深红色
- 3秒后自动隐藏消息
- 移除输入框 placeholder

---

## 🎯 今晚的优化任务

### Phase 1: 核心功能完善 (1小时)

#### 1.1 配置文件管理优化 ⭐⭐⭐
**优先级**: HIGH  
**预计时间**: 30分钟

- [ ] **复制 basic.yml 到应用数据目录**
  - 当前问题: basic_test.yml 在开发目录，打包后找不到
  - 解决方案: 启动时检查并复制到应用数据目录
  - 位置: `src-tauri/src/lib.rs` 的 `get_config_path()`

- [ ] **配置文件验证**
  - 加载配置前验证 JSON 格式
  - 验证必需字段（server.host, server.port）
  - 提供更友好的错误提示

- [ ] **配置备份机制**
  - 每次保存前备份当前配置
  - 保留最近 3 个备份
  - 提供"恢复上次配置"功能

#### 1.2 错误处理改进 ⭐⭐
**优先级**: MEDIUM  
**预计时间**: 30分钟

- [ ] **网络请求超时**
  - 当前问题: 订阅链接获取可能无限等待
  - 添加 30 秒超时
  - 显示进度提示
  - 位置: `src-tauri/src/subscription.rs`

- [ ] **更详细的错误信息**
  - 区分网络错误、解析错误、配置错误
  - 中文错误消息 + 技术细节
  - 示例: "无法连接到订阅服务器 (网络超时)" 而不是 "错误: timeout"

---

### Phase 2: 用户体验提升 (1小时)

#### 2.1 订阅管理增强 ⭐⭐⭐
**优先级**: HIGH  
**预计时间**: 30分钟

- [ ] **显示订阅状态**
  - 最后更新时间
  - 节点数量
  - 连接状态（成功/失败）
  - 位置: `src/App.tsx` - 订阅卡片

- [ ] **批量操作**
  - 全选/全不选
  - 批量启用/禁用
  - 批量删除（带确认）

- [ ] **订阅排序**
  - 拖拽排序
  - 或者添加上移/下移按钮
  - 保存排序顺序

#### 2.2 服务器状态改进 ⭐⭐
**优先级**: MEDIUM  
**预计时间**: 30分钟

- [ ] **实时状态指示**
  - 显示当前连接的订阅数
  - 显示总节点数
  - 显示服务器运行时长

- [ ] **服务器日志**
  - 显示最近的访问日志
  - 记录配置更新时间
  - 位置: 新增日志面板

- [ ] **快速复制订阅链接**
  - 服务器启动后，一键复制订阅 URL
  - 复制成功提示

---

### Phase 3: 性能和稳定性 (45分钟)

#### 3.1 缓存机制 ⭐⭐
**优先级**: MEDIUM  
**预计时间**: 30分钟

- [ ] **订阅内容缓存**
  - 缓存已获取的订阅内容
  - 添加"刷新"按钮手动更新
  - 启动时使用缓存，后台更新
  - 位置: `src-tauri/src/subscription.rs`

- [ ] **配置合并结果缓存**
  - 只在订阅变化时重新合并
  - 避免重复计算区域分组

#### 3.2 资源清理 ⭐
**优先级**: LOW  
**预计时间**: 15分钟

- [ ] **清理旧的输出文件**
  - 定期清理超过 7 天的 output_config.yaml
  - 清理备份文件

- [ ] **内存优化**
  - 确保停止服务器时正确释放资源
  - 检查是否有内存泄漏

---

### Phase 4: UI/UX 美化 (45分钟)

#### 4.1 视觉改进 ⭐⭐
**优先级**: MEDIUM  
**预计时间**: 30分钟

- [ ] **加载状态**
  - 启动服务器时显示加载动画
  - 获取订阅时显示进度条
  - 位置: `src/App.tsx`

- [ ] **空状态优化**
  - 无订阅时显示引导图
  - 添加"快速开始"按钮
  - 示例订阅链接（灰色文字）

- [ ] **响应式布局**
  - 支持窗口缩放
  - 最小窗口尺寸限制
  - 位置: `src/App.css`

#### 4.2 交互优化 ⭐
**优先级**: LOW  
**预计时间**: 15分钟

- [ ] **键盘快捷键**
  - Enter 提交表单
  - Esc 取消编辑
  - Ctrl/Cmd + S 保存

- [ ] **表单验证**
  - URL 格式验证
  - 重复订阅检测
  - 实时验证反馈

---

### Phase 5: 高级功能 (30分钟)

#### 5.1 订阅测试 ⭐⭐⭐
**优先级**: HIGH  
**预计时间**: 20分钟

- [ ] **测试订阅链接**
  - 添加"测试"按钮
  - 检查链接是否可访问
  - 预览节点数量
  - 不保存到配置
  - 位置: 新增 Tauri command `test_subscription`

#### 5.2 配置导入/导出 ⭐⭐
**优先级**: MEDIUM  
**预计时间**: 10分钟

- [ ] **导出配置**
  - 导出所有订阅为 JSON
  - 方便备份和迁移

- [ ] **导入配置**
  - 从 JSON 文件导入
  - 合并或替换现有配置

---

## 🔧 技术债务清理

### 代码质量
- [ ] **添加单元测试** (15分钟)
  - 测试 `get_config_path()` 函数
  - 测试订阅 CRUD 操作
  - 测试区域分组逻辑

- [ ] **代码注释** (10分钟)
  - 关键函数添加中文注释
  - 复杂逻辑解释

- [ ] **移除未使用的代码** (5分钟)
  - 清理 CLI 工具的 warning
  - 移除废弃的函数

### 文档更新
- [ ] **更新 README.md** (10分钟)
  - 添加新功能说明
  - 更新截图
  - 常见问题 FAQ

---

## 📋 执行顺序建议

### 今晚必须完成 (2小时)
1. ✅ **测试崩溃修复** - 确保应用不崩溃
2. **配置文件管理优化** - 解决打包后找不到文件的问题
3. **网络请求超时** - 防止卡死
4. **订阅测试功能** - 用户体验关键功能
5. **显示订阅状态** - 基本信息展示

### 推荐完成 (1小时)
6. **服务器状态改进** - 显示更多信息
7. **加载状态** - 视觉反馈
8. **快速复制订阅链接** - 方便使用
9. **订阅排序** - 组织管理

### 可选完成 (30分钟)
10. **批量操作** - 高级功能
11. **配置导入/导出** - 备份功能
12. **表单验证** - 防错
13. **代码测试** - 质量保证

---

## 🎯 成功标准

### 必须满足
- [ ] 开发模式和打包后都能正常运行
- [ ] 启动服务器不崩溃
- [ ] 所有 CRUD 操作正常工作
- [ ] 配置文件在正确位置保存和读取
- [ ] 网络请求有超时保护

### 期望达到
- [ ] 用户能看到订阅状态和节点数
- [ ] 有明确的加载和错误提示
- [ ] 配置文件有备份机制
- [ ] 支持测试订阅链接

### 加分项
- [ ] 批量操作支持
- [ ] 键盘快捷键
- [ ] 配置导入/导出
- [ ] 完整的单元测试

---

## 📝 注意事项

1. **每完成一个功能立即测试** - 在开发模式和打包后都测试
2. **提交前运行测试**:
   ```bash
   bun run tsc --noEmit
   cargo test --manifest-path src-tauri/Cargo.toml
   cargo clippy --manifest-path src-tauri/Cargo.toml
   ```
3. **小步提交** - 每个功能单独提交，方便回滚
4. **保持向后兼容** - 不要破坏现有配置文件格式

---

## 🚀 开始执行

准备好了吗？让我们从 **Phase 1.1 配置文件管理优化** 开始！
