# 测试清单 - Test Checklist

## 快速开始

```bash
cd /Users/lei/dev/personal/proxy-sub-manager
./test-debug.sh
```

## 测试清单

### ✅ 准备工作

- [ ] 确保端口 8080 未被占用
  ```bash
  lsof -i :8080
  # 如果有进程占用，先关闭
  ```

- [ ] 确保配置文件存在
  ```bash
  ls -la subscriptions.json basic_test.yml
  ```

- [ ] 启动应用
  ```bash
  bun run tauri dev
  ```

- [ ] 打开开发者工具
  - 在应用窗口右键 -> "Inspect Element"
  - 切换到 "Console" 标签页

---

### 🗑️ 测试 1: 删除订阅

**步骤：**
1. [ ] 查看当前订阅列表（应该有至少 1 个订阅）
2. [ ] 点击任意订阅的「删除」按钮
3. [ ] 在弹出的确认框点击「确定」
4. [ ] 观察界面更新

**期望结果：**
- [ ] 前端控制台显示：
  ```
  🔍 准备删除订阅，index: X
  ✓ 用户确认删除，调用 delete_subscription
  ✓ 删除成功: ✅ 订阅删除成功
  ```

- [ ] 终端显示：
  ```
  🔍 delete_subscription 被调用，index: X
  ✓ 配置路径: ...
  ✓ 当前订阅数量: X
  ✓ 已删除订阅: [订阅名称]
  ✓ 配置已保存
  ```

- [ ] 界面上该订阅消失
- [ ] 显示绿色成功消息（3 秒后自动消失）
- [ ] **应用没有崩溃**

**如果失败：**
- 检查前端控制台是否有错误
- 检查终端输出到哪一步停止
- 截图发送详细信息

---

### 🚀 测试 2: 启动服务器

**步骤：**
1. [ ] 确保服务器状态显示「已停止」（红点）
2. [ ] 点击「启动服务器」按钮
3. [ ] 观察状态变化

**期望结果：**
- [ ] 前端控制台显示：
  ```
  🔍 开始启动服务器...
  ✓ 调用 start_proxy_server 命令
  ✓ 服务器启动成功: ...
  ✓ startServer 函数执行完毕
  ```

- [ ] 终端显示（关键部分）：
  ```
  🔍 start_proxy_server 被调用
  ✓ 使用配置文件: ...
  ✓ 配置加载成功，订阅数量: X
  ✓ 基础配置加载成功: basic_test.yml
  ✓ 配置合并成功
  ✓ 配置已保存到: output_config.yaml
  🚀 服务器任务已启动
  ✓ TcpListener 绑定成功
  ✨ 服务器已启动，等待请求...
  ```

- [ ] 状态指示器变为绿色「运行中」
- [ ] 显示成功消息，包含订阅链接
- [ ] **应用没有崩溃**（⭐ 最重要）

**如果失败：**
- 查看终端输出在哪一步失败
- 检查是否是端口被占用（错误信息会包含 "bind"）
- 检查是否是配置文件问题（错误信息会包含 "加载配置"）

---

### 🌐 测试 3: 访问订阅链接

**步骤：**
1. [ ] 确保服务器已启动（上一步）
2. [ ] 打开浏览器（任意浏览器）
3. [ ] 访问：`http://127.0.0.1:8080/config`

**期望结果：**
- [ ] 浏览器显示 YAML 格式的配置内容
- [ ] 包含 `proxies:` 和 `proxy-groups:` 等字段
- [ ] 终端可能显示请求日志
- [ ] **应用没有崩溃**

**如果失败：**
- 检查浏览器地址是否正确
- 检查端口是否是 8080（看启动消息）
- 尝试访问 `http://127.0.0.1:8080/health`（应该返回 "OK"）

---

### 🛑 测试 4: 停止服务器

**步骤：**
1. [ ] 确保服务器正在运行（绿色状态）
2. [ ] 点击「停止服务器」按钮
3. [ ] 观察状态变化

**期望结果：**
- [ ] 终端显示：
  ```
  🔍 stop_proxy_server 被调用
  ✓ 发送关闭信号
  ✅ 服务器停止命令执行成功
  🛑 收到关闭信号，开始优雅关闭...
  ✓ 服务器已优雅关闭
  ✓ 服务器状态已更新为停止
  ```

- [ ] 状态指示器变为红色「已停止」
- [ ] 显示成功消息
- [ ] **应用没有崩溃**（⭐ 最重要）

**如果失败：**
- 查看终端是否有错误信息
- 检查应用是否仍在运行

---

### ✏️ 测试 5: 添加订阅

**步骤：**
1. [ ] 点击「+ 添加订阅」按钮
2. [ ] 填写订阅名称（例如："测试订阅"）
3. [ ] 填写订阅 URL（任意有效 URL）
4. [ ] 点击「添加」按钮

**期望结果：**
- [ ] 显示成功消息
- [ ] 新订阅出现在列表中
- [ ] 表单自动清空并隐藏

---

### 📝 测试 6: 编辑订阅

**步骤：**
1. [ ] 点击任意订阅的「编辑」按钮
2. [ ] 修改名称或 URL
3. [ ] 点击「保存」按钮

**期望结果：**
- [ ] 显示成功消息
- [ ] 订阅信息更新
- [ ] 表单隐藏

---

### 🔄 测试 7: 启用/禁用订阅

**步骤：**
1. [ ] 点击任意订阅的「启用」或「禁用」按钮
2. [ ] 观察状态变化

**期望结果：**
- [ ] 订阅状态立即更新
- [ ] 启用的订阅显示绿色「启用」标签
- [ ] 禁用的订阅没有标签且半透明

---

### 🔁 测试 8: 完整流程

**步骤：**
1. [ ] 添加一个新订阅
2. [ ] 启动服务器
3. [ ] 访问 `http://127.0.0.1:8080/config` 验证配置
4. [ ] 停止服务器
5. [ ] 禁用刚添加的订阅
6. [ ] 再次启动服务器
7. [ ] 再次访问配置（应该不包含被禁用的订阅）
8. [ ] 停止服务器
9. [ ] 删除测试订阅

**期望结果：**
- [ ] 所有步骤都成功
- [ ] 没有任何崩溃
- [ ] 消息提示清晰

---

## 测试结果

### ✅ 全部通过
恭喜！所有功能正常工作。可以进行下一步优化。

### ⚠️ 部分失败
记录以下信息：

**失败的测试：**
```
测试编号: 
失败步骤: 
错误现象: 
前端控制台输出: 
终端输出: 
截图: 
```

### ❌ 严重问题
如果应用频繁崩溃，记录：

**崩溃信息：**
```
触发操作: 
崩溃前终端输出: 
崩溃前控制台输出: 
系统日志（如果有）: 
```

---

## 快速诊断

### 问题：删除不工作
```bash
# 检查配置文件权限
ls -la subscriptions.json

# 检查文件内容
cat subscriptions.json | jq .
```

### 问题：服务器无法启动
```bash
# 检查端口占用
lsof -i :8080

# 检查配置文件
cat subscriptions.json | jq .server

# 检查基础配置
ls -la basic_test.yml
```

### 问题：应用崩溃
```bash
# 重新编译（清理缓存）
cd /Users/lei/dev/personal/proxy-sub-manager
cargo clean --manifest-path src-tauri/Cargo.toml
bun run tauri build

# 检查系统日志（macOS）
log show --predicate 'process == "proxy-sub-manager"' --last 5m
```

---

## 完成

测试完成后，填写：

- 测试时间：__________
- 通过测试数：____/8
- 发现的问题：
  - [ ] 无
  - [ ] 有（见上方记录）

- 总体评价：
  - [ ] ✅ 可以继续开发
  - [ ] ⚠️ 需要修复部分问题
  - [ ] ❌ 需要重大修复
