# æ¶æ„è¯´æ˜

## é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Tauri åº”ç”¨çª—å£                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         React å‰ç«¯ (localhost:1420)           â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  - è®¢é˜…ç®¡ç† UI                                â”‚  â”‚
â”‚  â”‚  - æœåŠ¡å™¨æ§åˆ¶                                 â”‚  â”‚
â”‚  â”‚  - çŠ¶æ€æ˜¾ç¤º                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â†•                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Rust åç«¯ (Tauri Core)              â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  - Tauri Commands API                         â”‚  â”‚
â”‚  â”‚  - è®¢é˜…è·å–ä¸è§£æ                             â”‚  â”‚
â”‚  â”‚  - ä»£ç†åˆ†ç»„é€»è¾‘                               â”‚  â”‚
â”‚  â”‚  - HTTP æœåŠ¡å™¨ (Axum)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†•
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   å¤–éƒ¨æœåŠ¡                  â”‚
        â”‚                            â”‚
        â”‚  - ä»£ç†è®¢é˜…æœåŠ¡å™¨           â”‚
        â”‚  - Clash å®¢æˆ·ç«¯             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¼€å‘æ¨¡å¼å·¥ä½œæµç¨‹

### å‘½ä»¤æ‰§è¡Œæµç¨‹

```bash
$ bun run dev
    â†“
è¿è¡Œ "tauri dev"
    â†“
è¯»å– tauri.conf.json
    â†“
æ‰§è¡Œ beforeDevCommand: "bun run dev:frontend"
    â†“
å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ (localhost:1420)
    â†“
ç­‰å¾…å‰ç«¯æœåŠ¡å™¨å°±ç»ª
    â†“
ç¼–è¯‘ Rust ä»£ç 
    â†“
å¯åŠ¨ Tauri åº”ç”¨çª—å£
    â†“
åº”ç”¨åŠ è½½ localhost:1420
    â†“
âœ… å¼€å‘ç¯å¢ƒå°±ç»ª
```

### æ–‡ä»¶ç›‘å¬å’Œçƒ­é‡è½½

```
å‰ç«¯æ–‡ä»¶å˜åŒ– (src/*.tsx)
    â†“
Vite æ£€æµ‹åˆ°å˜åŒ–
    â†“
çƒ­æ¨¡å—æ›¿æ¢ (HMR)
    â†“
æµè§ˆå™¨è‡ªåŠ¨æ›´æ–°
    â†“
æ— éœ€é‡å¯åº”ç”¨


Rust æ–‡ä»¶å˜åŒ– (src-tauri/src/*.rs)
    â†“
Tauri æ£€æµ‹åˆ°å˜åŒ–
    â†“
é‡æ–°ç¼–è¯‘ Rust ä»£ç 
    â†“
è‡ªåŠ¨é‡å¯åº”ç”¨
    â†“
éœ€è¦å‡ ç§’é’Ÿ
```

## ç»„ä»¶äº¤äº’

### å‰ç«¯ â†’ åç«¯é€šä¿¡

```typescript
// React ç»„ä»¶
import { invoke } from "@tauri-apps/api/core";

// è°ƒç”¨ Rust å‘½ä»¤
const result = await invoke<string>("start_proxy_server");
```

```rust
// Rust å‘½ä»¤
#[tauri::command]
async fn start_proxy_server() -> Result<String, String> {
    // å¤„ç†é€»è¾‘
    Ok("æœåŠ¡å™¨å·²å¯åŠ¨".to_string())
}
```

### è®¢é˜…å¤„ç†æµç¨‹

```
UI: ç‚¹å‡»"å¯åŠ¨æœåŠ¡å™¨"
    â†“
invoke("start_proxy_server")
    â†“
Rust: start_proxy_server()
    â†“
load_app_config("subscriptions.json")
    â†“
å¹¶è¡Œè·å–æ‰€æœ‰è®¢é˜…
    â”œâ”€ fetch_subscription(url1)
    â”œâ”€ fetch_subscription(url2)
    â””â”€ fetch_subscription(url3)
    â†“
åˆå¹¶æ‰€æœ‰ä»£ç†èŠ‚ç‚¹
    â†“
extract_region() è¯†åˆ«åœ°åŒº
    â†“
create_region_groups() åˆ›å»ºåœ°åŒºåˆ†ç»„
    â†“
create_service_groups() åˆ›å»ºæœåŠ¡åˆ†ç»„
    â†“
ä¿å­˜é…ç½®åˆ°æ–‡ä»¶
    â†“
å¯åŠ¨ Axum HTTP æœåŠ¡å™¨
    â†“
è¿”å›è®¢é˜…é“¾æ¥ç»™ UI
```

## ä¸¤ç§ä½¿ç”¨æ¨¡å¼

### æ¨¡å¼ 1ï¼šå›¾å½¢ç•Œé¢ (UI)

```
ç”¨æˆ· â†’ Tauri åº”ç”¨
       â†“
    React UI
       â†“
    Tauri Commands
       â†“
    Rust åç«¯
       â†“
    HTTP æœåŠ¡å™¨ (http://127.0.0.1:8080/config)
       â†“
    Clash å®¢æˆ·ç«¯
```

**ç‰¹ç‚¹:**
- âœ… ç”¨æˆ·å‹å¥½
- âœ… å¯è§†åŒ–ç®¡ç†è®¢é˜…
- âœ… å®æ—¶çŠ¶æ€æ˜¾ç¤º
- âœ… å¯åŠ¨/åœæ­¢æ§åˆ¶

### æ¨¡å¼ 2ï¼šå‘½ä»¤è¡Œå·¥å…· (CLI)

```
ç”¨æˆ· â†’ cargo run --bin cli
       â†“
    è¯»å– subs.txt
       â†“
    Rust CLI ç¨‹åº
       â†“
    ç”Ÿæˆ clash.yml
       â†“
    ç”¨æˆ·æ‰‹åŠ¨å¯¼å…¥ Clash
```

**ç‰¹ç‚¹:**
- âš¡ å¿«é€Ÿæµ‹è¯•
- ğŸ” è¯¦ç»†ç»Ÿè®¡è¾“å‡º
- ğŸ¯ é€‚åˆå¼€å‘è°ƒè¯•
- ğŸ“ æ— éœ€ UI

## æ•°æ®æµ

### è®¢é˜…æ•°æ®æµ

```
è¿œç¨‹è®¢é˜…æœåŠ¡å™¨
    â†“
HTTP GET (å¯èƒ½ Base64 ç¼–ç )
    â†“
Base64 è§£ç  (å¦‚éœ€è¦)
    â†“
YAML è§£æ
    â†“
æå– proxies æ•°ç»„
    â†“
ååºåˆ—åŒ–ä¸º ProxyNode
    â†“
æ·»åŠ æœºåœºå‰ç¼€
    â†“
è¯†åˆ«åœ°åŒºä¿¡æ¯
    â†“
å­˜å‚¨åˆ°å†…å­˜
```

### é…ç½®ç”Ÿæˆæµç¨‹

```
æ‰€æœ‰ ProxyNode
    â†“
æŒ‰åœ°åŒºåˆ†ç»„
    â”œâ”€ HK åœ°åŒº â†’ [HKèŠ‚ç‚¹åˆ—è¡¨]
    â”œâ”€ US åœ°åŒº â†’ [USèŠ‚ç‚¹åˆ—è¡¨]
    â””â”€ ...
    â†“
åˆ›å»ºæœåŠ¡ä¸“ç”¨ç»„
    â”œâ”€ ChatGPT â†’ [US, UK, SG, TW èŠ‚ç‚¹]
    â”œâ”€ Gemini â†’ [US, UK, SG, HK, TW èŠ‚ç‚¹]
    â””â”€ èŠ‚ç‚¹é€‰æ‹© â†’ [æ‰€æœ‰èŠ‚ç‚¹]
    â†“
ç»„è£… ClashConfig
    â”œâ”€ base_config
    â”œâ”€ proxies
    â”œâ”€ proxy-groups
    â””â”€ rules
    â†“
åºåˆ—åŒ–ä¸º YAML
    â†“
ä¿å­˜æˆ–é€šè¿‡ HTTP æä¾›
```

## æŠ€æœ¯æ ˆè¯¦è§£

### å‰ç«¯æŠ€æœ¯æ ˆ

```
React 19
  â”œâ”€ å‡½æ•°å¼ç»„ä»¶ + Hooks
  â”œâ”€ useState ç®¡ç†çŠ¶æ€
  â”œâ”€ useEffect ç”Ÿå‘½å‘¨æœŸ
  â””â”€ TypeScript ç±»å‹å®‰å…¨

Vite 7
  â”œâ”€ å¼€å‘æœåŠ¡å™¨
  â”œâ”€ çƒ­æ¨¡å—æ›¿æ¢ (HMR)
  â””â”€ å¿«é€Ÿæ„å»º

Tauri API
  â”œâ”€ @tauri-apps/api/core (invoke)
  â””â”€ IPC é€šä¿¡
```

### åç«¯æŠ€æœ¯æ ˆ

```
Rust 2021
  â”œâ”€ ç±»å‹å®‰å…¨
  â”œâ”€ å†…å­˜å®‰å…¨
  â””â”€ é«˜æ€§èƒ½

Tauri 2.0
  â”œâ”€ è·¨å¹³å°æ¡Œé¢åº”ç”¨
  â”œâ”€ å‘½ä»¤ç³»ç»Ÿ
  â””â”€ ç³»ç»Ÿ tray

Tokio
  â”œâ”€ å¼‚æ­¥è¿è¡Œæ—¶
  â”œâ”€ å¹¶å‘ä»»åŠ¡
  â””â”€ å¼‚æ­¥ I/O

Axum 0.7
  â”œâ”€ HTTP æœåŠ¡å™¨
  â”œâ”€ è·¯ç”±
  â””â”€ ä¸­é—´ä»¶

å…¶ä»–ä¾èµ–
  â”œâ”€ reqwest (HTTP å®¢æˆ·ç«¯)
  â”œâ”€ serde (åºåˆ—åŒ–)
  â”œâ”€ serde_yaml (YAML è§£æ)
  â””â”€ base64 (ç¼–ç è§£ç )
```

## æ€§èƒ½ä¼˜åŒ–

### å¹¶å‘è·å–è®¢é˜…

```rust
// å¹¶è¡Œè·å–å¤šä¸ªè®¢é˜…
for sub in subscriptions {
    if !sub.enabled {
        continue;
    }
    
    match fetch_subscription(sub).await {
        Ok(proxies) => {
            all_proxies.extend(proxies);
        }
        Err(e) => {
            eprintln!("è·å–å¤±è´¥: {}", e);
        }
    }
}
```

### å¼‚æ­¥ HTTP æœåŠ¡å™¨

```rust
// Axum å¼‚æ­¥æœåŠ¡å™¨ï¼Œå¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚
tokio::spawn(async move {
    axum::serve(listener, app).await
});
```

## å®‰å…¨è€ƒè™‘

### 1. è®¢é˜… URL å®‰å…¨
- ä¸åœ¨æ—¥å¿—ä¸­æ‰“å°å®Œæ•´ URL
- æ”¯æŒ HTTPS è®¢é˜…

### 2. HTTP æœåŠ¡å™¨å®‰å…¨
- é»˜è®¤åªç›‘å¬ 127.0.0.1
- ä¸æš´éœ²åˆ°å…¬ç½‘

### 3. é…ç½®æ–‡ä»¶å®‰å…¨
- subscriptions.json åŒ…å«æ•æ„Ÿä¿¡æ¯
- åº”æ·»åŠ åˆ° .gitignore

## æ‰©å±•ç‚¹

### æ·»åŠ æ–°çš„ Tauri å‘½ä»¤

```rust
// 1. å®šä¹‰å‘½ä»¤
#[tauri::command]
fn my_new_command(param: String) -> Result<String, String> {
    Ok(format!("å¤„ç†: {}", param))
}

// 2. æ³¨å†Œå‘½ä»¤
.invoke_handler(tauri::generate_handler![
    // ...å…¶ä»–å‘½ä»¤
    my_new_command
])
```

```typescript
// 3. å‰ç«¯è°ƒç”¨
const result = await invoke<string>("my_new_command", { 
    param: "æµ‹è¯•" 
});
```

### æ·»åŠ æ–°çš„åˆ†ç»„é€»è¾‘

```rust
// åœ¨ create_service_groups å‡½æ•°ä¸­æ·»åŠ 
let netflix_regions = ["US", "SG", "JP"];
let netflix_proxies: Vec<String> = proxies
    .iter()
    .filter(|p| {
        p.region
            .as_ref()
            .map(|r| netflix_regions.contains(&r.as_str()))
            .unwrap_or(false)
    })
    .map(|p| p.name.clone())
    .collect();

groups.push(ProxyGroup {
    name: "Netflix".to_string(),
    group_type: "select".to_string(),
    proxies: netflix_proxies,
    extra: HashMap::new(),
});
```

### æ·»åŠ æ–°çš„åœ°åŒºè¯†åˆ«

```rust
// åœ¨ extract_region å‡½æ•°ä¸­æ·»åŠ 
let regions = vec![
    // ...ç°æœ‰åœ°åŒº
    ("è²å¾‹å®¾", "PH"), ("PH", "PH"),
    ("æ³°å›½", "TH"), ("TH", "TH"),
];
```

## è°ƒè¯•æŠ€å·§

### å‰ç«¯è°ƒè¯•

```bash
# 1. æ‰“å¼€å¼€å‘è€…å·¥å…·
# åœ¨åº”ç”¨ä¸­æŒ‰ Cmd+Option+I (Mac) æˆ– F12 (Windows/Linux)

# 2. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
console.log("è°ƒè¯•ä¿¡æ¯", data);

# 3. ä½¿ç”¨ React DevTools
# å®‰è£…æµè§ˆå™¨æ‰©å±•åå¯åœ¨ Tauri ä¸­ä½¿ç”¨
```

### åç«¯è°ƒè¯•

```bash
# 1. æ·»åŠ æ‰“å°è¯­å¥
println!("è°ƒè¯•: {:?}", variable);

# 2. æŸ¥çœ‹ç»ˆç«¯è¾“å‡º
# Tauri ä¼šåœ¨ç»ˆç«¯æ˜¾ç¤ºæ‰€æœ‰ println! è¾“å‡º

# 3. ä½¿ç”¨ Rust è°ƒè¯•å™¨
# VS Code + rust-analyzer + CodeLLDB
```

### ç½‘ç»œè°ƒè¯•

```bash
# æŸ¥çœ‹ HTTP æœåŠ¡å™¨è¯·æ±‚
curl http://127.0.0.1:8080/config

# æµ‹è¯•è®¢é˜…è·å–
curl -s "è®¢é˜…URL" | base64 -d | head -50
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### åº”ç”¨å¯åŠ¨å¤±è´¥

```bash
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat subscriptions.json | jq .

# 2. æ£€æŸ¥åŸºç¡€é…ç½®
cat basic_test.yml | head -20

# 3. æŸ¥çœ‹ Rust ç¼–è¯‘é”™è¯¯
bun run dev
# æŸ¥çœ‹ç»ˆç«¯è¾“å‡º
```

### è®¢é˜…è·å–å¤±è´¥

```bash
# 1. æ‰‹åŠ¨æµ‹è¯•è®¢é˜…
curl -v "è®¢é˜…URL"

# 2. æ£€æŸ¥ Base64 ç¼–ç 
curl -s "è®¢é˜…URL" | base64 -d

# 3. ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æµ‹è¯•
cargo run --bin cli -- subs.txt test.yml
```

### HTTP æœåŠ¡å™¨æ— å“åº”

```bash
# 1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
lsof -i :8080

# 2. æµ‹è¯•è¿æ¥
curl http://127.0.0.1:8080/health

# 3. æŸ¥çœ‹æ—¥å¿—
# ç»ˆç«¯ä¸­æŸ¥çœ‹ Rust è¾“å‡º
```

## æ›´å¤šèµ„æº

- [Tauri å®˜æ–¹æ–‡æ¡£](https://tauri.app/)
- [Axum å®˜æ–¹æ–‡æ¡£](https://docs.rs/axum/)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [Clash é…ç½®æ–‡æ¡£](https://github.com/Dreamacro/clash/wiki/configuration)
